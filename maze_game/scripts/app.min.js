require(["levels.min","cookies.min"],function(n,t){function f(){this.codes={37:"left",39:"right",38:"forward",40:"backward"};this.states={left:!1,right:!1,forward:!1,backward:!1};document.addEventListener("keydown",this.onKey.bind(this,!0),!1);document.addEventListener("keyup",this.onKey.bind(this,!1),!1);i.display.addEventListener("touchstart",this.onTouch.bind(this),!1);i.display.addEventListener("touchmove",this.onTouch.bind(this),!1);i.display.addEventListener("touchend",this.onTouchEnd.bind(this),!1)}function e(n,t,i){this.image=new Image;this.image.src=n;this.width=t;this.height=i}function u(n,t,i){this.x=n;this.y=t;this.direction=i;this.paces=0}function o(n){this.size=n.size;this.walllevel=n.walls;this.skybox=n.skybox?new e(n.skybox.path,n.skybox.width,n.skybox.height):new e("assets/bg.png",2e3,750);this.wallTexture=n.wallTexture?new e(n.wallTexture.path,n.wallTexture.width,n.wallTexture.height):new e("assets/wall_texture.jpg",700,516);this.light=n.light?n.light:.6}function r(n,t,r){this.ctx=n.getContext("2d");this.width=n.width=window.innerWidth*.5;this.height=n.height=window.innerHeight*.5;this.resolution=t;this.spacing=this.width/t;this.focalLength=r||.8;this.range=i.MOBILE?14:28;this.lightRange=5;this.scale=(this.width+this.height)/1200}function s(){this.frame=this.frame.bind(this);this.lastTime=0;this.callback=function(){}}var i=this;i.CIRCLE=Math.PI*2;i.MOBILE=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent);i.TOUCHSCREEN="ontouchstart"in window;i.currentPostition=document.getElementById("position");i.currentLevelDisplay=document.getElementById("currentLevel");i.instructions=document.getElementById("instructions");i.display=document.getElementById("display");f.prototype.onTouch=function(n){var t=n.touches[0];this.onTouchEnd(n);if(t.pageY<window.innerHeight*.5)this.onKey(!0,{keyCode:38});else if(t.pageX<window.innerWidth*.5)this.onKey(!0,{keyCode:37});else if(t.pageY>window.innerWidth*.5)this.onKey(!0,{keyCode:39})};f.prototype.onTouchEnd=function(n){this.states={left:!1,right:!1,forward:!1,backward:!1};n.preventDefault();n.stopPropagation()};f.prototype.onKey=function(n,t){var i=this.codes[t.keyCode];typeof i!="undefined"&&(this.states[i]=n,t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation())};u.prototype.rotate=function(n){this.direction=(this.direction+n+i.CIRCLE)%i.CIRCLE};u.prototype.walk=function(t,r){var u=Math.cos(this.direction)*t,f=Math.sin(this.direction)*t,e;r.get(this.x+u,this.y)<=0&&(this.x+=u);r.get(this.x,this.y+f)<=0&&(this.y+=f);this.y>r.size||this.y<0||this.x>r.size||this.x<0?i.mazeCompleted?(i.loop.stop(),e=i.currentLevel+1,n.length==e?alert("Congratulations! You have escaped from all mazes. You are aMazing ;)"):(confirm("You have escaped! Click OK to move on to the next level or CANCEL to play this level over again.")&&i.currentLevel++,i.onRestartLevel())):i.mazeCompleted=!0:this.paces+=t};u.prototype.update=function(n,t,r){i.updatesMade++;n.left&&this.rotate(-Math.PI*r);n.right&&this.rotate(Math.PI*r);n.forward&&this.walk(3*r,t);n.backward&&this.walk(-3*r,t);currentPostition.innerHTML="X: "+Math.round(this.x)+" | Y: "+Math.round(this.y)+" | Direction: "+this.getCardinalDirection(this.direction);i.updatesMade%25==0&&i.setLocation(this.x,this.y,this.direction)};u.prototype.getCardinalDirection=function(n){var i="E",t=.39269908125,r=.7853981625,u=1.570796325,f=2.3561944875,e=3.14159265,o=3.9269908125,s=4.712388975,h=5.4977871375;return n>=r-t&&n<=r+t?i="SE":n>=u-t&&n<=u+t?i="S":n>=f-t&&n<=f+t?i="SW":n>=e-t&&n<=e+t?i="W":n>=o-t&&n<=o+t?i="NW":n>=s-t&&n<=s+t?i="N":n>=h-t&&n<=h+t&&(i="NE"),i};o.prototype.get=function(n,t){return(n=Math.floor(n),t=Math.floor(t),n<0||n>this.size-1||t<0||t>this.size-1)?-1:this.walllevel[t*this.size+n]};o.prototype.cast=function(n,t,i){function f(n){var t=e(r,u,n.x,n.y),s=e(u,r,n.y,n.x,!0),h=t.length2<s.length2?o(t,1,0,n.distance,t.y):o(s,0,1,n.distance,s.x);return h.distance>i?[n]:[n].concat(f(h))}function e(n,t,i,r,u){if(t===0)return h;var f=t>0?Math.floor(i+1)-i:Math.ceil(i-1)-i,e=f*(n/t);return{x:u?r+e:i+f,y:u?i+f:r+e,length2:f*f+e*e}}function o(n,t,i,f,e){var o=u<0?t:0,h=r<0?i:0;return n.height=s.get(n.x-o,n.y-h),n.distance=f+Math.sqrt(n.length2),n.shading=t?u<0?2:0:r<0?2:1,n.offset=e-Math.floor(e),n}var s=this,r=Math.sin(t),u=Math.cos(t),h={length2:Infinity};return f({x:n.x,y:n.y,height:0,distance:0})};o.prototype.update=function(n){this.light>0?this.light=Math.max(this.light-10*n,0):Math.random()*5<n&&(this.light=2)};r.prototype.render=function(n,t){this.drawSky(n.direction,t.skybox,t.light);this.drawColumns(n,t)};r.prototype.drawSky=function(n,t){var r=t.width*(this.height/t.height)*2,u=n/i.CIRCLE*-r;this.ctx.save();this.ctx.drawImage(t.image,u,0,r,this.height);u<r-this.width&&this.ctx.drawImage(t.image,u+r,0,r,this.height);this.ctx.restore()};r.prototype.drawColumns=function(n,t){var i;for(this.ctx.save(),i=0;i<this.resolution;i++){var u=i/this.resolution-.5,r=Math.atan2(u,this.focalLength),f=t.cast(n,n.direction+r,this.range);this.drawColumn(i,f,r,t)}this.ctx.restore()};r.prototype.drawColumn=function(n,t,i,r){for(var u=this.ctx,s=r.wallTexture,c=Math.floor(n*this.spacing),l=Math.ceil(this.spacing),h=-1,e,f,a,o;++h<t.length&&t[h].height<=0;);for(e=t.length-1;e>=0;e--)f=t[e],e===h&&(a=Math.floor(s.width*f.offset),o=this.project(f.height,i,f.distance),u.globalAlpha=1,u.drawImage(s.image,a,0,1,s.height,c,o.top,l,o.height),u.fillStyle="#000",u.globalAlpha=Math.max((f.distance+f.shading)/this.lightRange-r.light,0),u.fillRect(c,o.top,l,o.height)),u.fillStyle="#fff",u.globalAlpha=.15};r.prototype.project=function(n,t,i){var r=i*Math.cos(t),u=this.height*n/r,f=this.height/2*(1+1/r);return{top:f-u,height:u}};s.prototype.start=function(n){this.callback=n;requestAnimationFrame(this.frame)};s.prototype.stop=function(){this.callback=null;requestAnimationFrame(this.frame)};s.prototype.frame=function(n){var t=(n-this.lastTime)/1e3;this.lastTime=n;this.callback!==null&&(t<.2&&this.callback(t),requestAnimationFrame(this.frame))};i.init=function(n){t.setItem("level",i.currentLevel,Infinity);i.currentLevelDisplay.innerHTML="Level: "+n.id;i.mazeCompleted=!1;i.player=new u(t.hasItem("x")?Number(t.getItem("x")):n.startingPoint.x,t.hasItem("y")?Number(t.getItem("y")):n.startingPoint.y,t.hasItem("dir")?Number(t.getItem("dir")):n.startingDirection);i.map=new o(n);i.controls=new f;i.camera=new r(i.display,i.MOBILE?320:640,.5);i.loop=new s;i.loop.start(function(n){i.player.update(i.controls.states,i.map,n);i.camera.render(i.player,i.map)});instructions.style.display="block";setTimeout(function(){instructions.style.display="none"},1e4)};i.onRestartLevel=function(){i.loop.stop();i.clearLocation();i.init(n[i.currentLevel])};i.onRestartGame=function(){t.removeItem("level");i.currentLevel=0;i.onRestartLevel()};i.clearLocation=function(){t.removeItem("x");t.removeItem("y");t.removeItem("dir")};i.setLocation=function(n,i,r){t.setItem("x",n,Infinity);t.setItem("y",i,Infinity);t.setItem("dir",r,Infinity)};document.getElementById("restartLevel").addEventListener("click",i.onRestartLevel.bind(this),!1);document.getElementById("restartGame").addEventListener("click",i.onRestartGame.bind(this),!1);i.instructions.innerHTML=i.TOUCHSCREEN?"Press and hold the center of the screen to walk forward and the lower corners to rotate.":"Use directional keys to navigate the world of aMaze to find freedom.";i.instructions.innerHTML+="<br /><br />Your maze location and level are saved in your browser so you can resume on your next visit.";i.updatesMade=0;i.currentLevel=t.hasItem("level")?Number(t.getItem("level")):0;i.init(n[i.currentLevel])});